<!DOCTYPE html>
<html>
<head><title>修改密码</title><script src="https://cdn.tailwindcss.com"></script><script src="https://unpkg.com/vue@3/dist/vue.global.js"></script></head>
<body class="bg-slate-50 min-h-screen">
    <div id="app" class="max-w-xl mx-auto pt-20 px-4">
        <div class="bg-white p-8 rounded shadow">
            <h1 class="text-2xl font-bold mb-6">修改密码 - <span class="text-blue-600">{{ username }}</span></h1>
            <form @submit.prevent="changePwd">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">当前旧密码</label>
                    <input type="password" v-model="oldPass" class="w-full p-2 border rounded" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">新密码</label>
                    <input type="password" v-model="newPass" class="w-full p-2 border rounded" required placeholder="至少 6 位">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">确认新密码</label>
                    <input type="password" v-model="confirmPass" class="w-full p-2 border rounded" required>
                </div>
                <div v-if="msg" :class="isError?'bg-red-100 text-red-600':'bg-green-100 text-green-600'" class="mb-4 p-2 rounded text-center">{{ msg }}</div>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700">确认修改</button>
                    <a href="/" class="flex-1 text-center border border-gray-300 text-gray-700 font-bold py-2 rounded hover:bg-gray-50">返回首页</a>
                </div>
            </form>
        </div>
    </div>
    <script>
        Vue.createApp({
            data() { return { oldPass:'', newPass:'', confirmPass:'', msg:'', isError:false } },
            methods: {
                async changePwd() {
                    if(this.newPass !== this.confirmPass) { this.isError=true; this.msg='两次输入的新密码不一致'; return; }
                    const fd = new FormData(); fd.append('old_password', this.oldPass); fd.append('new_password', this.newPass);
                    try {
                        const res = await fetch('/api/change-password', {method:'POST', body:fd});
                        const d = await res.json();
                        this.isError = d.status !== 'success';
                        this.msg = d.message;
                        if(!this.isError) {
                            this.oldPass=''; this.newPass=''; this.confirmPass='';
                        }
                    } catch(e) { this.isError=true; this.msg='网络错误'; }
                }
            }
        }).mount('#app')
    </script>
</body></html>
